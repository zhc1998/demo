<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="../js/jquery-3.3.1.min.js"></script>

    <!-- 引入bootstrap的css -->
    <link  href="../js/bootstrap/css/bootstrap.min.css" rel="stylesheet" >
    <!-- 引入bootstrap-treeview的css -->
    <link  href="../js/treeview/bootstrap-treeview.min.css" rel="stylesheet" >
    <!-- 引入bootstrap-addTabs的css -->
    <link  href="../js/addTabs/addTabs.css" rel="stylesheet" >
    <!-- 引入bootstrap-table的css -->
    <link  href="../js/table/bootstrap-table.min.css" rel="stylesheet" >
    <!-- 引入fileinput的css -->
    <link type="text/css" rel="stylesheet" href="../js/fileinput/css/fileinput.min.css" />
    <!-- 引入my97 -->
    <script type="text/javascript" src="../js/my97/WdatePicker.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="../js/bootstrap/js/bootstrap.min.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="../js/treeview/bootstrap-treeview.min.js"></script>
    <!-- 引入bootstrap的js-->
    <script type="text/javascript" src="../js/addTabs/addTabs.js"></script>
    <!-- 引入bootstrap-table的js-->
    <script type="text/javascript" src="../js/table/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="../js/table/locale/bootstrap-table-zh-CN.min.js"></script>
    <!-- 引入bootbox.js -->
    <script type="text/javascript" src="../js/bootbox/bootbox.js"></script>
    <!-- 引入fileinput的js -->
    <script type="text/javascript" src="../js/fileinput/js/fileinput.min.js"></script>
    <!--  引入fileinput的js -->
    <script type="text/javascript" src="../js/fileinput/js/locales/zh.js"></script>


    <script type="text/javascript" src="../js/fileinput/themes/fa/theme.js"></script>
    <style type="text/css">
        body{
            background-image: url("../js/img/th.jpg");
            background-size:100% 100%;
            background-attachment:fixed;
        }
        #login_box{
            padding: 35px;
            border-radius:15px;
            background: #56666B;
            color: #fff;
        }
        #login_title{
            color: #000000;
        }
    </style>
</head>
<body>
<div style="height: 300px"></div>
            <form id="formId" >
                <table style=" margin:auto; width:50%">
                    <tr>
                        <td width="120" class="form-group">登录帐号：</td>
                        <td>
                            <input type="text"  class="form-control" id="username" name="username" placeholder="账号" style="width:200px;"/>
                        </td>
                    </tr>
                    <tr>
                        <td width="120" class="form-group">验证码：</td>
                        <td><input type="text"  class="form-control" name="code" placeholder="验证码" style="width:200px;"/></td>
                        <td><img src="../xxf/getcode" onclick="changecode(this)"></td>
                    </tr>

                    <tr>
                        <td colspan="2">
                            <button type="button" class="btn btn-success" onclick="yz()">下一步</button>
                        </td>
                    </tr>
                </table>
            </form>

</body>
<script>

    function yzPhone() {
        var phoneNumReg = /^1[3|4|5|7|8]\d{9}$/
        var phone=$("#phone").val()
        if(!phoneNumReg.test(phone)) {
            $("#msg").html("手机号码有误，请重填，手机号码11位数字，目前支持前两位13、14、15、16、17、18手机号码")
            return false;
        }
        $("#msg").html("")
        return true;
    }
    function yzNewpassword(){
        var newpassword=$("input[name='newpassword']").val();
        var newpassword2=$("input[name='newpassword2']").val();
        if(newpassword==newpassword2){
            $("#msg2").html("")
            return true;
        }
        $("#msg2").html("请与密码保持一致")
        return false;
    }
    function huo(){
        num=$("input[name='phone']").val();
        username=$("#username").val();
        $.ajax({
            url:"../xxf/huoCode?username="+username,
            data:$("#formId2").serialize(),
            type:"post",
            success:function(data){
                if(data=="0"){
                    setInterval('countDown()',1000);
                    alert("短信已发送,请注意查看")
                }if(data=="1"){
                    alert("请输入正确手机号")
                }

            }
        })
    }
    var time=60;
    function countDown(){
        if(time>0){
            $("#date").html(time--)
        }else{
            $("#date").css('display','none');
        }
    }
    function xia(){
        $.ajax({
            url:"../xxf/queryMembers",
            data:$("#formId").serialize(),
            success:function(data){
                if(data=="1"){alert("手机验证码错误")}
                if(data=="0")
                    location.href="../toshow/tofrontLogin"
            }
        })
    }

    var res;

    function createAddContent(url) {
        $.ajax({
            url: url,
            async: false,
            success: function (data) {
                res = data;
            }
        });
        return res;
    }
    function yz() {
        $.ajax({
            url:"../xxf/yz",
            data:$("#formId").serialize(),
            success:function(data){
                if(data=="1"){
                    alert("验证码错误")
                }
                if(data=="2"){
                    alert("账号不存在")
                }
                if(data=="0"){

                        //打开新增弹框
                        bootbox.dialog({
                            title: '手机验证',
                            message: createAddContent("../toshow/toYz"),
                            closeButton: true,//是否显示关闭按钮
                            buttons: {
                                "success": {
                                    "label": "<i class='icon-ok'></i> 确认修改",
                                    "className": "btn-sm btn-success",
                                    "callback": function () {
                                        if(yzPhone()&yzNewpassword()){
                                            $.ajax({
                                                url: '../xxf/queryCodeByPhone',
                                                type: 'post',
                                                cache:false,
                                                data: $("#formId2").serialize(),
                                                success: function (data) {
                                                    if(data=="2"){
                                                        alert("验证码错误")
                                                    }
                                                    if(data=="0"){
                                                        alert("密码修改成功")
                                                        location.href="../toshow/tofrontLogin"
                                                    }


                                                    //刷新表格
                                                }
                                            });
                                        }

                                    }
                                },
                                "cancel": {
                                    "label": "<i class='icon-info'></i> 取消",
                                    "className": "btn-sm btn-danger",
                                    "callback": function () {

                                    }
                                }
                            }

                        });

            }   }
        })
    }
    function changecode(img){
        $(img).attr("src",$(img).attr("src")+"?1");
    } ;


</script>
</html>